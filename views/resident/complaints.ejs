<%- layout("layouts/boilerplate") %>

    <style>
        /* === BASE STYLES === */
        .complaints-container {
            padding: 20px;
        }

        .complaints-box {
            transition: background-color 0.2s ease;
        }

        .complaints-box:hover {
            background-color: #f8f9fa;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .delete-btn:hover {
            background-color: #fee2e2;
        }

        .stat-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* === LARGE DESKTOP (1400px and above) === */
        @media screen and (min-width: 1400px) {
            .complaints-container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 30px;
            }

            .com-header h2 {
                font-size: 2.2rem;
            }

            .stat-card {
                min-height: 120px;
            }

            .stat-card h4 {
                font-size: 2rem;
            }

            .stat-card i {
                font-size: 2.5rem !important;
            }

            .complaints-box {
                padding: 25px 30px;
            }

            .complaints h3 {
                font-size: 1.8rem;
            }
        }

        /* === STANDARD DESKTOP (1200px to 1399px) === */
        @media screen and (min-width: 1200px) and (max-width: 1399px) {
            .complaints-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 25px;
            }

            .com-header {
                margin-bottom: 25px;
            }

            .com-header h2 {
                font-size: 2rem;
            }

            .stat-card {
                min-height: 110px;
            }

            .stat-card h4 {
                font-size: 1.8rem;
            }

            .stat-card i {
                font-size: 2.2rem !important;
            }

            .complaints-box {
                padding: 20px 25px;
            }
        }

        /* === SMALL LAPTOP/LARGE TABLET (1024px to 1199px) === */
        @media screen and (min-width: 1024px) and (max-width: 1199px) {
            .complaints-container {
                padding: 20px;
            }

            .com-header {
                flex-direction: row;
                gap: 15px;
                margin-bottom: 20px;
            }

            .com-header h2 {
                font-size: 1.8rem;
            }

            .com-header .right a {
                padding: 10px 20px !important;
                font-size: 0.9rem;
            }

            .row.g-3 {
                gap: 15px !important;
            }

            .col-md-3 {
                flex: 0 0 calc(50% - 10px);
                max-width: calc(50% - 10px);
            }

            .stat-card {
                padding: 18px !important;
                min-height: 100px;
            }

            .stat-card h4 {
                font-size: 1.6rem;
            }

            .stat-card i {
                font-size: 2rem !important;
            }

            .complaints-box {
                padding: 18px 20px;
                flex-direction: column;
                gap: 15px;
            }

            .complaints-box .d-flex.flex-row {
                align-self: flex-end;
            }

            .complaints h3 {
                font-size: 1.5rem;
                padding: 20px 25px !important;
            }
        }

        /* === TABLET (768px to 1023px) === */
        @media screen and (min-width: 768px) and (max-width: 1023px) {
            .complaints-container {
                padding: 15px;
            }

            .com-header {
                flex-direction: column;
                gap: 15px;
                text-align: left;
            }

            .com-header h2 {
                font-size: 1.7rem;
                margin-bottom: 5px;
            }

            .com-header p {
                font-size: 0.9rem;
            }

            .com-header .right {
                align-self: flex-start;
            }

            .com-header .right a {
                padding: 12px 25px !important;
                font-size: 0.9rem;
            }

            .row.g-3 {
                margin: 0 !important;
            }

            .col-md-3 {
                flex: 0 0 calc(50% - 8px);
                max-width: calc(50% - 8px);
                margin-bottom: 15px;
            }

            .stat-card {
                padding: 16px !important;
                min-height: 90px;
            }

            .stat-card p {
                font-size: 0.85rem;
                margin-bottom: 8px !important;
            }

            .stat-card h4 {
                font-size: 1.4rem;
            }

            .stat-card i {
                font-size: 1.8rem !important;
            }

            .complaints {
                margin-top: 25px !important;
            }

            .complaints h3 {
                font-size: 1.4rem;
                padding: 18px 20px !important;
            }

            .complaints-box {
                padding: 16px 18px;
                flex-direction: column;
                gap: 12px;
            }

            .complaints-box h6 {
                font-size: 1.1rem;
            }

            .complaints-box p {
                font-size: 0.9rem;
                margin-left: 0 !important;
            }

            .complaints-box .text-muted {
                margin-left: 0 !important;
                font-size: 0.85rem;
            }

            .complaints-box .d-flex.flex-row {
                align-self: flex-start;
                gap: 8px;
            }

            .status-badge,
            .priority-badge {
                font-size: 0.75rem;
                padding: 3px 10px;
            }

            .delete-btn {
                padding: 6px;
            }

            .delete-btn i {
                font-size: 1.2rem !important;
            }
        }

        /* === MOBILE LARGE (481px to 767px) === */
        @media screen and (min-width: 481px) and (max-width: 767px) {
            .complaints-container {
                padding: 12px;
            }

            .com-header {
                flex-direction: column;
                gap: 12px;
                text-align: left;
            }

            .com-header h2 {
                font-size: 1.5rem;
                margin-bottom: 3px;
            }

            .com-header p {
                font-size: 0.85rem;
                margin-bottom: 0;
            }

            .com-header .right a {
                padding: 10px 20px !important;
                font-size: 0.85rem;
                display: inline-block;
                width: auto;
            }

            .row.g-3 {
                margin: 0 !important;
            }

            .col-md-3 {
                flex: 0 0 100%;
                max-width: 100%;
                margin-bottom: 10px;
            }

            .stat-card {
                padding: 14px !important;
                min-height: 80px;
            }

            .stat-card p {
                font-size: 0.8rem;
                margin-bottom: 6px !important;
            }

            .stat-card h4 {
                font-size: 1.3rem;
            }

            .stat-card i {
                font-size: 1.6rem !important;
            }

            .complaints {
                margin-top: 20px !important;
            }

            .complaints h3 {
                font-size: 1.3rem;
                padding: 15px 18px !important;
            }

            .complaints-box {
                margin: 0 !important;
                /* remove .ms-4 offset          */
                border-bottom: 1px solid #f1f3f4;
                padding: 16px 14px;
                display: flex;
                flex-direction: column;
                gap: 10px
            }

            .complaints-box:last-child {
                border-bottom: none
            }


            .complaints-box .d-flex.align-items-center {
                margin-bottom: 6px !important;
            }

            .complaints-box h6 {
                font-size: 1.05rem;
                line-height: 1.3;
                word-break: break-word;
                /* handles very long words      */
            }

            .complaints-box i.bi-clock {
                font-size: 1rem !important;
            }

            .complaints-box p {
                font-size: .85rem;
                margin: 0 0 8px 0;
                line-height: 1.45;
                word-wrap: break-word;
            }

            .complaints-box .text-muted {
                font-size: .8rem;
                margin: 0;
                line-height: 1.4
            }

            .complaints-box .d-flex.flex-row {
                flex-wrap: wrap;
                gap: 8px;
                align-items: center;
                align-self: flex-start
            }

            .status-priority-wrapper {
                display: flex;
                gap: 6px;
                flex-wrap: wrap
            }

            .status-badge,
            .priority-badge {
                font-size: .72rem;
                padding: 3px 9px
            }

            .delete-btn {
                padding: 5px
            }

            .delete-btn i {
                font-size: 1.1rem;
                color: #dc3545
            }
        }

        /* === MOBILE SMALL (320px to 480px) === */
       @media(min-width:320px) and (max-width:480px){
  .complaints-container{padding:10px;}
  .com-header h2{font-size:1.3rem}
  .com-header p{font-size:.8rem}

  .com-header .right a{
      display:block;width:100%;text-align:center;
      padding:8px 16px;font-size:.8rem
  }

  .row.g-3{margin:0}
  .col-md-3{flex:0 0 100%;max-width:100%;margin-bottom:8px}
  .stat-card{padding:12px;min-height:70px}
  .stat-card h4{font-size:1.2rem}
  .stat-card i{font-size:1.4rem}

  /* —— complaint list —— */
  .complaints-box{
      margin:0 !important;
      border-bottom:1px solid #f1f3f4;
      padding:14px 12px;
      display:flex;flex-direction:column;
      gap:8px
  }
  .complaints-box:last-child{border-bottom:none}

  .complaints-box i.bi-clock{font-size:.9rem;margin-right:6px}
  .complaints-box h6{
      font-size:.98rem;line-height:1.3;
      word-break:break-word
  }
  .complaints-box p{
      font-size:.8rem;margin:0 0 6px 0;line-height:1.45
  }
  .complaints-box .text-muted{
      font-size:.75rem;margin:0;line-height:1.35
  }

  /* badge + delete line */
  .complaints-box .d-flex.flex-row{
      flex-direction:column;
      align-items:flex-start;
      gap:6px
  }
  .status-priority-wrapper{display:flex;gap:6px;flex-wrap:wrap}

  .status-badge,.priority-badge{
      font-size:.65rem;padding:2px 7px
  }

  .delete-btn{padding:4px}
  .delete-btn i{font-size:1rem;color:#dc3545}
}


        /* === EXTRA SMALL MOBILE (below 320px) === */
        @media screen and (max-width: 319px) {
            .complaints-container {
                padding: 8px;
            }

            .com-header h2 {
                font-size: 1.1rem;
            }

            .com-header p {
                font-size: 0.75rem;
            }

            .com-header .right a {
                padding: 6px 12px !important;
                font-size: 0.75rem;
            }

            .stat-card {
                padding: 10px !important;
                min-height: 65px;
            }

            .stat-card p {
                font-size: 0.7rem;
            }

            .stat-card h4 {
                font-size: 1.1rem;
            }

            .stat-card i {
                font-size: 1.2rem !important;
            }

            .complaints h3 {
                font-size: 1.1rem;
                padding: 10px 12px !important;
            }

            .complaints-box {
                padding: 10px 12px;
            }

            .complaints-box h6 {
                font-size: 0.9rem;
            }

            .complaints-box p {
                font-size: 0.75rem;
            }

            .complaints-box .text-muted {
                font-size: 0.7rem;
            }

            .status-badge,
            .priority-badge {
                font-size: 0.6rem;
                padding: 2px 5px;
            }

            .delete-btn i {
                font-size: 0.9rem !important;
            }
        }

        /* === LANDSCAPE ORIENTATION FOR MOBILE === */
        @media screen and (orientation: landscape) and (max-height: 600px) and (max-width: 1023px) {
            .com-header {
                margin-bottom: 12px;
            }

            .com-header h2 {
                font-size: 1.2rem;
            }

            .com-header p {
                font-size: 0.75rem;
            }

            .stat-card {
                min-height: 60px;
                padding: 8px !important;
            }

            .stat-card h4 {
                font-size: 1.1rem;
            }

            .complaints {
                margin-top: 15px !important;
            }

            .complaints h3 {
                padding: 10px 15px !important;
                font-size: 1.1rem;
            }

            .complaints-box {
                padding: 10px 12px;
            }
        }

        /* === UNIVERSAL IMPROVEMENTS === */
        @media screen and (max-width: 1023px) {
            .complaints-box {
                border-bottom: 1px solid #f1f3f4;
            }

            .complaints-box:last-child {
                border-bottom: none;
            }

            .delete-btn:focus {
                outline: 2px solid #dc3545;
                outline-offset: 2px;
            }

            .status-badge,
            .priority-badge {
                white-space: nowrap;
            }

            .com-header .right a:focus {
                outline: 2px solid #0d6efd;
                outline-offset: 2px;
            }
        }

        /* === STATUS AND PRIORITY COLORS === */
        .status-complete {
            background-color: #d1e7dd;
            color: #0f5132;
        }

        .status-inprogress {
            background-color: #cff4fc;
            color: #055160;
        }

        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #664d03;
        }

        .priority-high {
            background-color: #f8d7da;
            color: #721c24;
        }

        .priority-medium {
            background-color: #fff3cd;
            color: #664d03;
        }

        .priority-low {
            background-color: #d1e7dd;
            color: #0f5132;
        }

        /* === HIGH DPI SCREENS === */
        @media screen and (-webkit-min-device-pixel-ratio: 2),
        screen and (min-resolution: 192dpi) {

            .stat-card i,
            .complaints-box i,
            .status-badge,
            .priority-badge {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }

        /* === PRINT STYLES === */
        @media print {

            .com-header .right,
            .delete-btn {
                display: none !important;
            }

            .complaints-box {
                break-inside: avoid;
                border-bottom: 1px solid #000;
            }

            .status-badge,
            .priority-badge {
                color: #000 !important;
                background: transparent !important;
                border: 1px solid #000 !important;
            }
        }
    </style>

    <body>
        <div class="complaints-container">
            <div class="com-header d-flex justify-content-between">
                <div class="left">
                    <h2 class="fw-bold">Complaints</h2>
                    <p class="text-muted">File and track your complaints</p>
                </div>
                <div class="right d-flex align-items-center">
                    <a href="/resident/newComplain"
                        class="rounded p-2 px-4 text-white bg-primary text-decoration-none fw-bold border-0">
                        <i class="bi bi-plus text-white fw-bold"></i> File Complaint
                    </a>
                </div>
            </div>

            <div class="mt-4">
                <div class="row g-3">
                    <!-- Total Complaints -->
                    <div class="col-md-3 col-sm-6">
                        <div
                            class="stat-card border rounded-3 bg-white d-flex justify-content-between align-items-center p-3">
                            <div>
                                <p class="mb-1 text-muted">Total Complaints</p>
                                <h4 class="fw-bold text-dark">
                                    <%= totalComplains %>
                                </h4>
                            </div>
                            <i class="bi bi-chat-left fs-3 text-secondary"></i>
                        </div>
                    </div>

                    <!-- Rejected Complaints -->
                    <div class="col-md-3 col-sm-6">
                        <div
                            class="stat-card border rounded-3 bg-white d-flex justify-content-between align-items-center p-3">
                            <div>
                                <p class="mb-1 text-muted">Rejected</p>
                                <h4 class="fw-bold text-danger">
                                    <%= counts.Reject %>
                                </h4>
                            </div>
                            <i class="bi bi-exclamation-triangle fs-3 text-danger"></i>
                        </div>
                    </div>

                    <!-- In Progress -->
                    <div class="col-md-3 col-sm-6">
                        <div
                            class="stat-card border rounded-3 bg-white d-flex justify-content-between align-items-center p-3">
                            <div>
                                <p class="mb-1 text-muted">In Progress</p>
                                <h4 class="fw-bold text-primary">
                                    <%= counts.InProgress %>
                                </h4>
                            </div>
                            <i class="bi bi-clock fs-3 text-primary"></i>
                        </div>
                    </div>

                    <!-- Resolved -->
                    <div class="col-md-3 col-sm-6">
                        <div
                            class="stat-card border rounded-3 bg-white d-flex justify-content-between align-items-center p-3">
                            <div>
                                <p class="mb-1 text-muted">Resolved</p>
                                <h4 class="fw-bold text-success">
                                    <%= counts.Complete %>
                                </h4>
                            </div>
                            <i class="bi bi-check-circle fs-3 text-success"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="complaints border rounded mt-4 bg-white">
                <div class="complaints-header">
                    <h3 class="p-3 ps-5">Your Complaints</h3>
                </div>
                <hr>

                <% complainsDetails.forEach(cd=> { %>
                    <div class="complaints-box d-flex justify-content-between p-3 ms-4">
                        <div class="complaint-content">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-clock text-primary fs-5 me-2"></i>
                                <h6 class="mb-0 fw-bold fs-5">
                                    <%= cd.title %>
                                </h6>
                            </div>

                            <p class="mb-1 text-muted ms-4" style="font-size: 0.95rem;">
                                <%= cd.description %>
                            </p>

                            <div class="text-muted ms-4">
                                Filed on <%= cd.created_at.toISOString().split('T')[0] %> &nbsp; | &nbsp;
                                    Category: <%= cd.category %> &nbsp; | &nbsp;
                                        <a href="#" class="text-primary text-decoration-none">
                                            <%= cd.Attachments %>1 attachment(s)
                                        </a>
                            </div>
                        </div>

                        <!-- Right Status Badges -->
                        <div class="d-flex flex-row align-items-center gap-2 ms-3">
                            <div class="status-priority-wrapper">
                                <span class="status-badge status-<%= cd.status.toLowerCase().replace(' ', '') %>">
                                    <%= cd.status %>
                                </span>
                                <span class="priority-badge priority-<%= cd.priority.toLowerCase() %>">
                                    <%= cd.priority %>
                                </span>
                            </div>
                            <form action="/resident/complaints/<%= cd._id %>?_method=DELETE" method="post">
                                <button type="submit" class="delete-btn"
                                    onclick="return confirm('Are you sure you want to delete this complaint?')">
                                    <i class="fa-solid fa-trash text-danger fs-3"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    <hr>
                    <% }) %>
            </div>
        </div>
    </body>