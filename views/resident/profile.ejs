<%- layout("layouts/boilerplate") %>

<style>
  /* Custom styles */
  .profile-icon {
    background: linear-gradient(to bottom, #2a6ef0, #1976f2);
    color: white;
    box-shadow: 0 4px 8px rgba(42, 110, 240, 0.3);
    transition: box-shadow 0.3s ease;
    width: 100px;
    height: 100px;
  }

  .profile-icon:hover,
  .profile-icon:focus {
    box-shadow: 0 6px 14px rgba(42, 110, 240, 0.5);
  }

  .vehicle-icon {
    background-color: #e6f0ff;
    border-radius: 12px;
    color: #0d6efd;
  }

  /* Fix wrapping of .com-header on desktop */
  .com-header {
    flex-wrap: nowrap !important;
  }
  @media (max-width: 767.98px) {
    .com-header {
      flex-wrap: wrap !important;
    }
  }
</style>

<body>
  <div class="profile-container container py-3">
    <div class="event-container">
      <div class="com-header d-flex justify-content-between align-items-center flex-wrap flex-md-nowrap gap-2">
        <div class="left flex-grow-1 min-w-0">
          <h2 class="fw-bold mb-0 text-truncate">My Profile</h2>
          <p class="text-muted mb-0">Manage your personal information and family details</p>
        </div>
        <div class="right d-flex align-items-center flex-nowrap ms-3">
          <a href="/resident/profile/<%= profileInfo._id %>/edit" 
             class="btn btn-primary rounded px-4 d-inline-flex align-items-center flex-nowrap">
            <i class="fas fa-pen me-2"></i> Edit Profile
          </a>
        </div>
      </div>
    </div>

    <div class="resident-profile-box d-flex flex-column flex-lg-row gap-3 my-4">
      <div class="left-info bg-white rounded border p-3 flex-shrink-0" style="flex-basis:40%">
        <div
          class="profile-icon rounded-circle bg-primary text-white mx-auto mb-3 d-flex align-items-center justify-content-center"
          style="font-size:2rem;">
          <i class="fas fa-user"></i>
        </div>
        <h4 class="fw-bold text-center mb-1 text-truncate"><%= profileInfo.first_name %> <%= profileInfo.last_name %></h4>
        <p class="text-primary fw-bold text-center mb-1 text-truncate">Home <%= profileInfo.block %>-<%= profileInfo.flat_number %></p>
        <p class="text-center mb-3"><i class="fas fa-home"></i> Owner</p>
        <div>
          <p class="text-muted mb-2"><i class="fas fa-envelope me-2"></i><%= profileInfo.email %></p>
          <p class="text-muted mb-2"><i class="fas fa-phone me-2"></i><%= profileInfo.mobile_number %></p>
          <p class="text-muted mb-2"><i class="fas fa-users me-2"></i><%= profileInfo.name_of_each_member.length %> family members</p>
          <p class="text-muted mb-2"><i class="fas fa-car me-2"></i>2 vehicles</p>
          <p class="text-muted mb-0"><i class="fas fa-calendar-alt me-2"></i>Resident since Jan 2023</p>
        </div>
        <a href="/resident/profile/<%= profileInfo._id %>/change-password" class="btn btn-outline-secondary w-100 mt-3">
          <i class="fas fa-key me-2"></i>Change Password
        </a>
      </div>

      <div class="right-info bg-white rounded border p-3 flex-grow-1">
        <div class="personal-info-head mb-3">
          <h3>Personal Information</h3>
        </div>
        <hr>
        <div class="row g-3">
          <div class="col-6">
            <div>
              <p class="fw-semibold mb-1">First Name</p>
              <p class="text-muted mb-0"><%= profileInfo.first_name %></p>
            </div>
          </div>
          <div class="col-6">
            <div>
              <p class="fw-semibold mb-1">Last Name</p>
              <p class="text-muted mb-0"><%= profileInfo.last_name %></p>
            </div>
          </div>

          <div class="col-6">
            <div>
              <p class="fw-semibold mb-1">Email Address</p>
              <p class="text-muted mb-0"><%= profileInfo.email %></p>
            </div>
          </div>
          <div class="col-6">
            <div>
              <p class="fw-semibold mb-1">Phone Number</p>
              <p class="text-muted mb-0"><%= profileInfo.mobile_number %></p>
            </div>
          </div>

          <div class="col-6">
            <div>
              <p class="fw-semibold mb-1">Date of Birth</p>
              <p class="text-muted mb-0"><%= profileInfo.birth_date.toISOString().split('T')[0] %></p>
            </div>
          </div>
          <div class="col-6">
            <div>
              <p class="fw-semibold mb-1">Emergency Contact</p>
              <p class="text-muted mb-0"><%= profileInfo.emergency_number %></p>
            </div>
          </div>

          <div class="col-12">
            <div>
              <p class="fw-semibold mb-1">Family Members</p>
              <p class="text-muted mb-0"><%= profileInfo.name_of_each_member.length %></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="extra d-flex flex-column flex-md-row gap-3">
      <div class="extra-left bg-white rounded border p-3 flex-fill">
        <div class="extra-head d-flex justify-content-between align-items-center mb-3">
          <h4 class="fw-bold mb-0">Family Members</h4>
          <a href="/resident/addFamilyMember/<%= profileInfo._id %>/add" class="btn btn-primary rounded px-3">
            <i class="fas fa-plus me-1"></i> Add Member
          </a>
        </div>
        <hr>
        <% profileInfo.name_of_each_member.forEach(member => { %>
          <div class="member-info d-flex justify-content-between align-items-center py-2 border-bottom last-child:border-0">
            <h5 class="mb-0"><%= member %></h5>
            <!-- Optionally add edit/delete icons here -->
          </div>
        <% }) %>
      </div>

      <div class="extra-right bg-white rounded border p-3 flex-fill">
        <div class="extra-head d-flex justify-content-between align-items-center mb-3">
          <h4 class="fw-bold mb-0">Registered Vehicles</h4>
        </div>
        <hr>
        <% const vehicles=[ { type: 'four_wheeler' , label: '4-wheeler' , data: profileInfo.four_wheeler }, { type: 'two_wheeler' , label: '2-wheeler' , data: profileInfo.two_wheeler } ]; %>
        <% vehicles.forEach(vehicle => { if (vehicle.data && vehicle.data.trim() !== "") { %>
          <div class="vehicle-info-box d-flex justify-content-between align-items-center mb-3">
            <div class="left-vehicle d-flex align-items-center gap-3">
              <div class="vehicle-icon d-flex align-items-center justify-content-center rounded-3" style="width:58px; height:61px; font-size:1.5rem;">
                <i class="bi bi-car-front"></i>
              </div>
              <div>
                <h6 class="mb-0"><%= vehicle.data %></h6>
                <p class="bg-success bg-opacity-25 border rounded px-2 py-1 text-success d-inline-block small mb-0"><%= vehicle.label %></p>
              </div>
            </div>
            <div class="right-vehicle d-flex align-items-center justify-content-center">
              <a href="/resident/profile/<%= profileInfo._id %>/edit" class="btn btn-link text-primary p-1" aria-label="Edit <%= vehicle.label %>">
                <i class="fas fa-pen"></i>
              </a>
            </div>
          </div>
        <% }}) %>
      </div>
    </div>
  </div>
</body>
