<%- layout("layouts/boilerplate") %>

  <style>
    .main-card {
      width: 23rem !important;
    }


    @media (max-width: 576px) {
  /* Container padding adjustment */
  .vehicle-container, .owner-list-container, .event-container {
    padding: 0 1rem;
  }

  /* Header section responsive */
  .com-header h2 {
    font-size: 1.15rem;
    margin-bottom: 0.5rem;
  }

  .com-header p {
    font-size: 0.9rem;
    margin-bottom: 1rem;
  }

  /* Dashboard cards responsive - 2 per row (for 3 cards, 2+1 layout) */
  .row.g-3 .col-md-4 {
    width: 48%;
    flex: 0 0 48%;
    max-width: 48%;
    margin-bottom: 1rem;
  }

  /* Third card takes full width */
  .row.g-3 .col-md-4:nth-child(3) {
    width: 100%;
    flex: 0 0 100%;
    max-width: 100%;
  }

  /* Card content adjustment */
  .card {
    padding: 0.75rem;
    font-size: 0.9rem;
  }

  .card h6 {
    font-size: 0.8rem;
    margin-bottom: 0.25rem;
  }

  .card h3 {
    font-size: 1.1rem;
  }

  .card .fs-2 {
    font-size: 1.5rem;
  }

  /* Search section - side by side (80% input, 20% filter) */
  .mt-4.border.rounded.p-3.bg-white .row {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    gap: 0.5rem;
    margin-left: 0;
    margin-right: 0;
  }

  .mt-4.border.rounded.p-3.bg-white .col-md-9 {
    width: 75%;
    max-width: 75%;
    flex: 0 0 75%;
    padding-left: 0;
    padding-right: 0;
    margin-left: 0;
    margin-right: 0;
    min-width: 0;
    box-sizing: border-box;
  }

  .mt-4.border.rounded.p-3.bg-white .col-md-3 {
    width: 25%;
    max-width: 25%;
    flex: 0 0 25%;
    padding-left: 0;
    padding-right: 0;
    margin-left: 0;
    margin-right: 0;
    min-width: 0;
    box-sizing: border-box;
  }

  .input-group,
  #vehicleType {
    width: 100%;
    min-width: 0;
  }

  /* Vehicle cards - 1 per row on mobile */
  .vehicle-info .row.g-3 > .col-12,
  .vehicle-info .row.g-3 > .col-sm-6,
  .vehicle-info .row.g-3 > .col-md-4 {
    width: 100%;
    max-width: 100%;
    flex: 0 0 100%;
    margin-bottom: 1rem;
  }

  .vehicle-info .card {
    margin-bottom: 1rem;
    font-size: 0.85rem;
  }

  /* Vehicle card content adjustment */
  .vehicle-info .card .fs-1 {
    font-size: 1.5rem;
  }

  .vehicle-info .card .fs-5 {
    font-size: 0.9rem;
  }

  .vehicle-info .card h4 {
    font-size: 1rem;
  }

  /* Button adjustments */
  .d-flex.flex-column.flex-sm-row.gap-3.mt-3 {
    flex-direction: column;
    gap: 0.5rem;
  }

  .btn, .btn.w-100 {
    width: 100%;
  }

  /* Info head adjustment */
  .info-head h5 {
    font-size: 1rem;
  }

  /* Remove extra margins */
  .container {
    padding-left: 0;
    padding-right: 0;
  }
}

  </style>

  <body>
    <div class="vehicle-container">
      <div class="owner-list-container">
        <div class="event-container">
          <div class="com-header d-flex justify-content-between">
            <div class="left">
              <h2 class="fw-bold">Vehicle Search</h2>
              <p class="text-muted">Find vehicle owners for complaints or inquiries</p>
            </div>
          </div>
        </div>


        <div class="mt-4">
          <div class="row g-3">
            <!-- Total Vehicles -->
            <div class="col-md-4 col-sm-12">
              <div class="card p-3 d-flex justify-content-between align-items-center flex-row">
                <div>
                  <h6 class="text-muted">Total Vehicles</h6>
                  <h3 class="text-primary fw-bold">
                    <%= twoWheeler + fourWheeler %>
                  </h3>
                </div>
                <i class="bi bi-car-front text-primary fs-2"></i>
              </div>
            </div>

            <!-- Two Wheelers -->
            <div class="col-md-4 col-sm-12">
              <div class="card p-3 d-flex justify-content-between align-items-center flex-row">
                <div>
                  <h6 class="text-muted">Two Wheelers</h6>
                  <h3 class="text-success fw-bold">
                    <%= twoWheeler %>
                  </h3>
                </div>
                <i class="bi bi-bicycle text-primary fs-2"></i>
              </div>
            </div>

            <!-- Four Wheelers -->
            <div class="col-md-4 col-sm-12">
              <div class="card p-3 d-flex justify-content-between align-items-center flex-row">
                <div>
                  <h6 class="text-muted">Four Wheelers</h6>
                  <h3 class="text-warning fw-bold">
                    <%= fourWheeler %>
                  </h3>
                </div>
                <i class="bi bi-car-front text-primary fs-2"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-4 border rounded p-3 bg-white">
          <div class="row g-3 align-items-center">
            <!-- Search Box -->
            <div class="col-md-9 col-sm-12">
              <div class="input-group">
                <span class="input-group-text bg-white border-end-0">
                  <i class="bi bi-search text-muted"></i>
                </span>
                <input type="text" id="searchInput" class="form-control border-start-0"
                  placeholder="Search by registration number, owner name, or flat...">
              </div>
            </div>

            <!-- Filter Dropdown -->
            <div class="col-md-3 col-sm-12">
              <select id="vehicleType" class="form-select border-primary text-dark fw-semibold">
                <option selected>All Vehicles</option>
                <option>Two Wheelers</option>
                <option>Four Wheelers</option>
              </select>
            </div>
          </div>
        </div>

        <div class="vehicle-info mt-4 border rounded bg-white">
          <div class="info-head m-4">
            <h5 class="fw-bold">Search Results</h5>
          </div>
          <hr>

          <div class="container mb-3 mt-4">
            <div class="row g-3">
              <% allParkingDetails.forEach(pDetail=> { %>
                <div class="col-12 col-sm-6 col-md-4 vehicleCard"
                  data-four_wheeler="<%= pDetail.four_wheeler ? pDetail.four_wheeler : '' %>"
                  data-two_wheeler="<%= pDetail.two_wheeler ? pDetail.two_wheeler : '' %>"
                  data-owner="<%= (pDetail.first_name + ' ' + pDetail.last_name).toLowerCase() %>"
                  data-flat="<%= (pDetail.block + '-' + pDetail.flat_number).toLowerCase() %>">
                  <div class="card p-3 shadow-sm h-100">
                    <div class="row align-items-center mb-3">
                      <div class="col-auto">
                        <% if (pDetail.four_wheeler) { %>
                          <i class="bi bi-car-front fs-1 text-primary"></i>
                          <h4 class="mb-0">
                            <%= pDetail.four_wheeler %>
                              <span class="badge bg-light text-primary">4-wheeler</span>
                          </h4>
                          <% } %>
                            <% if (pDetail.two_wheeler) { %>
                              <i class="bi bi-bicycle fs-1 text-success"></i>
                              <h4 class="mb-0">
                                <%= pDetail.two_wheeler %>
                                  <span class="badge bg-light text-success">2-wheeler</span>
                              </h4>
                              <% } %>
                      </div>
                    </div>

                    <div class="mb-2 fs-5">
                      <strong>Owner :</strong>
                      <%= pDetail.first_name %>
                        <%= pDetail.last_name %> <br />
                          <strong>Flat :</strong> Block <%= pDetail.block %> - <%= pDetail.flat_number %> <br />
                              <strong>Phone :</strong> +91 <%= pDetail.mobile_number %> <br />
                    </div>

                    <div class="d-flex flex-column flex-sm-row gap-3 mt-3">
                      <button class="btn btn-primary w-100 w-sm-auto">Contact Owner</button>
                      <button class="btn btn-outline-secondary w-100 w-sm-auto">Report Issue</button>
                    </div>
                  </div>
                </div>
                <% }); %>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      function filterVehicle() {
        const search = document.getElementById("searchInput").value.toLowerCase();
        const filter = document.getElementById("vehicleType").value;
        const vehicleCards = document.querySelectorAll(".vehicleCard");

        vehicleCards.forEach(card => {
          const car = card.dataset.four_wheeler.toLowerCase();
          const bike = card.dataset.two_wheeler.toLowerCase();
          const owner = card.dataset.owner;
          const flat = card.dataset.flat;

          const matchesSearch =
            car.includes(search) ||
            bike.includes(search) ||
            owner.includes(search) ||
            flat.includes(search);

          const type = car ? "Four Wheelers" : "Two Wheelers";
          const matchesType = filter === "All Vehicles" || filter === type;

          if (matchesSearch && matchesType) {
            card.style.display = "block";
          } else {
            card.style.display = "none";
          }
        });
      }

      document.getElementById("searchInput").addEventListener("input", filterVehicle);
      document.getElementById("vehicleType").addEventListener("change", filterVehicle);
    </script>
  </body>